<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üé¨ Modular Video Search</title>
    <style>
      :root {
        --primary: #96b5ea;
        --primary-dark: #9699ea;
        --success: #22c55e;
        --warning: #f59e0b;
        --error: #ef4444;
        --bg: #fafafa;
        --surface: #ffffff;
        --border: #e5e7eb;
        --text: #111827;
        --text-muted: #6b7280;
        --accent: #8b5cf6;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }

      .header {
        text-align: center;
        margin-bottom: 3rem;
        background: var(--surface);
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
      }

      .header .subtitle {
        color: var(--text-muted);
        font-size: 1.1rem;
        margin-bottom: 1rem;
      }

      .header .architecture-badge {
        display: inline-block;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
      }

      .card {
        background: var(--surface);
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: var(--surface);
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.2s;
      }

      .stat-card:hover {
        transform: translateY(-2px);
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 0.25rem;
      }

      .stat-label {
        color: var(--text-muted);
        font-size: 0.875rem;
      }

      .search-section {
        margin-bottom: 2rem;
      }

      .search-container {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .search-input {
        flex: 1;
        padding: 1rem;
        border: 2px solid var(--border);
        border-radius: 12px;
        font-size: 1rem;
        outline: none;
        transition: all 0.2s;
        background: var(--surface);
      }

      .search-input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(150, 181, 234, 0.1);
      }

      .btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        box-shadow: 0 2px 8px rgba(150, 181, 234, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(150, 181, 234, 0.4);
      }

      .btn-secondary {
        background: var(--border);
        color: var(--text);
      }

      .btn-secondary:hover {
        background: #d1d5db;
      }

      .btn-danger {
        background: var(--error);
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .btn-success {
        background: var(--success);
        color: white;
      }

      .btn-success:hover {
        background: #16a34a;
      }

      .upload-area {
        border: 2px dashed var(--border);
        border-radius: 12px;
        padding: 3rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        margin-bottom: 1rem;
        background: var(--surface);
      }

      .upload-area:hover,
      .upload-area.dragover {
        border-color: var(--primary);
        background: #f8faff;
      }

      .upload-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--primary);
      }

      .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
      }

      .result-card {
        background: var(--surface);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: all 0.2s;
        border: 1px solid var(--border);
      }

      .result-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .result-info {
        padding: 1.5rem;
      }

      .result-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text);
        font-size: 1.1rem;
      }

      .result-meta {
        font-size: 0.875rem;
        color: var(--text-muted);
        margin-bottom: 1rem;
      }

      .confidence-bar {
        width: 100%;
        height: 6px;
        background: var(--border);
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 0.5rem;
      }

      .confidence-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--success), var(--warning));
        transition: width 0.3s;
        border-radius: 3px;
      }

      .confidence-text {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-align: right;
      }

      .status {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        margin: 1rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .status.success {
        background: #d1fae5;
        color: var(--success);
      }

      .status.error {
        background: #fee2e2;
        color: var(--error);
      }

      .status.info {
        background: #dbeafe;
        color: var(--primary);
      }

      .loading {
        display: inline-block;
        width: 1rem;
        height: 1rem;
        border: 2px solid var(--border);
        border-top: 2px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .tabs {
        display: flex;
        background: var(--surface);
        border-radius: 12px;
        padding: 0.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        flex-wrap: wrap;
      }

      .tab {
        flex: 1;
        padding: 1rem 1.5rem;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.2s;
        text-align: center;
        font-weight: 500;
        min-width: 120px;
      }

      .tab.active {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        box-shadow: 0 2px 8px rgba(150, 181, 234, 0.3);
      }

      .tab:not(.active):hover {
        background: var(--bg);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .search-options,
      .config-options {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }

      .search-options label,
      .config-options label {
        font-weight: 500;
        color: var(--text-muted);
      }

      .search-options select,
      .config-options select,
      .config-options input[type="number"] {
        padding: 0.5rem;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--surface);
      }

      .config-section {
        background: var(--bg);
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
      }

      .config-section h3 {
        color: var(--primary);
        margin-bottom: 1rem;
      }

      .config-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
      }

      .cache-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .cache-info {
        background: var(--bg);
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      .video-list {
        margin-top: 1.5rem;
      }

      .video-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: 0.5rem;
        background: var(--surface);
        transition: all 0.2s;
      }

      .video-item:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .video-info h4 {
        margin-bottom: 0.25rem;
      }

      .video-meta {
        font-size: 0.875rem;
        color: var(--text-muted);
      }

      .btn-small {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }

      .hidden {
        display: none !important;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: var(--border);
        border-radius: 4px;
        overflow: hidden;
        margin: 1rem 0;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        transition: width 0.3s;
      }

      .api-links {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 1rem;
        flex-wrap: wrap;
      }

      .api-link {
        padding: 0.5rem 1rem;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 6px;
        text-decoration: none;
        color: var(--text);
        font-size: 0.875rem;
        transition: all 0.2s;
      }

      .api-link:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      /* Modal Styles */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal-content {
        background: var(--surface);
        border-radius: 12px;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem;
        border-bottom: 1px solid var(--border);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-muted);
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }

      .modal-close:hover {
        background: var(--border);
      }

      .modal-body {
        padding: 1.5rem;
      }

      #frame-container {
        text-align: center;
        margin-bottom: 1rem;
      }

      #frame-container img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      #frame-container video {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      #frame-info {
        background: var(--bg);
        padding: 1rem;
        border-radius: 8px;
      }

      #frame-info p {
        margin-bottom: 0.5rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üé¨ Modular Video Search</h1>
        <p class="subtitle">
          High-performance semantic video search with clean modular architecture
        </p>
        <div class="architecture-badge">‚ú® Clean & Modular</div>

        <div class="api-links">
          <a href="/api/docs" class="api-link" target="_blank">üìö API Docs</a>
          <a href="/api/health" class="api-link" target="_blank">üíö Health</a>
          <a href="/api/stats" class="api-link" target="_blank">üìä Stats</a>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <div class="tab active" onclick="switchTab('search')">
          üîç Search Videos
        </div>
        <div class="tab" onclick="switchTab('upload')">üì§ Upload Video</div>
        <div class="tab" onclick="switchTab('videos')">üìÅ Video Library</div>
        <div class="tab" onclick="switchTab('config')">‚öôÔ∏è Configuration</div>
        <div class="tab" onclick="switchTab('cache')">üíæ Cache Manager</div>
        <div class="tab" onclick="switchTab('stats')">üìä System Stats</div>
      </div>

      <!-- Search Tab -->
      <div id="search-tab" class="tab-content active">
        <div class="card">
          <h2 style="margin-bottom: 1rem">üîç Search Your Videos</h2>
          <div class="search-container">
            <input
              type="text"
              id="search-input"
              class="search-input"
              placeholder="Search for videos... (e.g., 'car driving fast', 'football goals', 'cute animals')"
            />
            <button class="btn btn-primary" onclick="searchVideos()">
              <span id="search-icon">üîç</span> Search
            </button>
          </div>

          <div class="search-options">
            <label>Results:</label>
            <select id="result-count">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>

            <label style="margin-left: 1rem">Search powered by:</label>
            <span
              id="search-engine"
              style="color: var(--primary); font-weight: 600"
              >CLIP + HNSW</span
            >
          </div>
        </div>

        <div id="search-results"></div>

        <!-- Video Frame Preview Modal -->
        <div id="frame-modal" class="modal hidden">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="modal-title">Video Frame Preview</h3>
              <button
                class="modal-close"
                onclick="closeFrameModal(); event.stopPropagation();"
                style="z-index: 9999; position: relative"
              >
                &times;
              </button>
            </div>
            <div class="modal-body">
              <div id="frame-container">
                <p>Loading frame...</p>
              </div>
              <div id="frame-info">
                <p>
                  <strong>Video:</strong> <span id="modal-video-name"></span>
                </p>
                <p>
                  <strong>Timestamp:</strong> <span id="modal-timestamp"></span>
                </p>
                <p>
                  <strong>Confidence:</strong>
                  <span id="modal-confidence"></span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Upload Tab -->
      <div id="upload-tab" class="tab-content">
        <div class="card">
          <h2 style="margin-bottom: 1rem">üì§ Upload New Video</h2>

          <!-- Upload Method Selection -->
          <div style="margin-bottom: 2rem">
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem">
              <button
                id="file-upload-btn"
                class="btn"
                onclick="switchUploadMethod('file')"
                style="background: var(--accent-color); color: white"
              >
                üìÅ File Upload
              </button>
              <button
                id="youtube-download-btn"
                class="btn btn-outline"
                onclick="switchUploadMethod('youtube')"
              >
                üì∫ YouTube Download
              </button>
            </div>
          </div>

          <!-- File Upload Section -->
          <div id="file-upload-section">
            <div
              class="upload-area"
              id="upload-area"
              onclick="document.getElementById('file-input').click()"
            >
              <div class="upload-icon">üé¨</div>
              <p style="font-size: 1.1rem; margin-bottom: 0.5rem">
                Click to select or drag & drop video files
              </p>
              <p style="color: var(--text-muted); font-size: 0.875rem">
                Supports: MP4, AVI, MOV, MKV (max 1GB)
              </p>
            </div>
            <input
              type="file"
              id="file-input"
              accept=".mp4,.avi,.mov,.mkv"
              style="display: none"
              onchange="uploadVideo()"
            />
          </div>

          <!-- YouTube Download Section -->
          <div id="youtube-download-section" class="hidden">
            <div style="margin-bottom: 1rem">
              <label
                for="youtube-url"
                style="display: block; margin-bottom: 0.5rem; font-weight: 500"
              >
                YouTube URL:
              </label>
              <input
                type="url"
                id="youtube-url"
                placeholder="https://www.youtube.com/watch?v=..."
                style="
                  width: 100%;
                  padding: 0.75rem;
                  border: 1px solid var(--border-color);
                  border-radius: 0.5rem;
                  font-size: 1rem;
                "
              />
            </div>
            <div style="margin-bottom: 1rem">
              <label
                for="quality-select"
                style="display: block; margin-bottom: 0.5rem; font-weight: 500"
              >
                Quality:
              </label>
              <select
                id="quality-select"
                style="
                  width: 100%;
                  padding: 0.75rem;
                  border: 1px solid var(--border-color);
                  border-radius: 0.5rem;
                  font-size: 1rem;
                "
              >
                <option value="best">Best Quality</option>
                <option value="720p">720p</option>
                <option value="480p">480p</option>
                <option value="360p">360p</option>
                <option value="worst">Worst Quality (fastest)</option>
              </select>
            </div>
            <button
              class="btn"
              onclick="downloadYouTubeVideo()"
              style="background: var(--accent-color); color: white; width: 100%"
            >
              üì• Download & Process Video
            </button>
          </div>

          <div id="upload-progress" class="hidden">
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p id="upload-status-text">Uploading...</p>
          </div>

          <div id="upload-status"></div>
        </div>
      </div>

      <!-- Videos Tab -->
      <div id="videos-tab" class="tab-content">
        <div class="card">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 1rem;
            "
          >
            <h2>üìÅ Video Library</h2>
            <button class="btn btn-secondary" onclick="loadVideoList()">
              üîÑ Refresh
            </button>
          </div>
          <div id="video-list" class="video-list"></div>
        </div>
      </div>

      <!-- Configuration Tab -->
      <div id="config-tab" class="tab-content">
        <div class="card">
          <h2 style="margin-bottom: 1rem">‚öôÔ∏è System Configuration</h2>

          <!-- Processing Configuration -->
          <div class="config-section">
            <h3>üé¨ Video Processing Settings</h3>
            <div class="config-grid">
              <div>
                <label>Sampling Mode:</label>
                <select id="config-sampling-mode">
                  <option value="ultra_high">Ultra High (5 fps)</option>
                  <option value="high" selected>High (2 fps)</option>
                  <option value="medium">Medium (1 fps)</option>
                  <option value="low">Low (0.5 fps)</option>
                </select>
              </div>
              <div>
                <label>Max Frames per Video:</label>
                <input
                  type="number"
                  id="config-max-frames"
                  value="300"
                  min="50"
                  max="1000"
                />
              </div>
              <div>
                <label>Use CLIP Model:</label>
                <select id="config-use-clip">
                  <option value="true" selected>Yes (Better Quality)</option>
                  <option value="false">No (Faster Processing)</option>
                </select>
              </div>
              <div>
                <label>Enhanced Mode:</label>
                <select id="config-enhanced-mode">
                  <option value="true" selected>Enabled</option>
                  <option value="false">Disabled</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Search Configuration -->
          <div class="config-section">
            <h3>üîç Search Settings</h3>
            <div class="config-grid">
              <div>
                <label>Default Results Count:</label>
                <input
                  type="number"
                  id="config-default-results"
                  value="10"
                  min="1"
                  max="50"
                />
              </div>
              <div>
                <label>Cache Search Results:</label>
                <select id="config-cache-search">
                  <option value="true" selected>Enabled</option>
                  <option value="false">Disabled</option>
                </select>
              </div>
              <div>
                <label>Search Timeout (seconds):</label>
                <input
                  type="number"
                  id="config-search-timeout"
                  value="30"
                  min="5"
                  max="120"
                />
              </div>
            </div>
          </div>

          <!-- System Configuration -->
          <div class="config-section">
            <h3>üñ•Ô∏è System Settings</h3>
            <div class="config-grid">
              <div>
                <label>Auto-save Cache:</label>
                <select id="config-auto-save">
                  <option value="true" selected>Enabled</option>
                  <option value="false">Disabled</option>
                </select>
              </div>
              <div>
                <label>Log Level:</label>
                <select id="config-log-level">
                  <option value="DEBUG">Debug</option>
                  <option value="INFO" selected>Info</option>
                  <option value="WARNING">Warning</option>
                  <option value="ERROR">Error</option>
                </select>
              </div>
            </div>
          </div>

          <div style="margin-top: 2rem">
            <button class="btn btn-primary" onclick="saveConfiguration()">
              üíæ Save Configuration
            </button>
            <button
              class="btn btn-secondary"
              onclick="loadConfiguration()"
              style="margin-left: 1rem"
            >
              üîÑ Reset to Defaults
            </button>
          </div>

          <div id="config-status"></div>
        </div>
      </div>

      <!-- Cache Manager Tab -->
      <div id="cache-tab" class="tab-content">
        <div class="card">
          <h2 style="margin-bottom: 1rem">üíæ Cache Management</h2>

          <!-- Cache Info -->
          <div class="cache-info">
            <h3 style="margin-bottom: 1rem">üìä Cache Statistics</h3>
            <div class="stats">
              <div class="stat-card">
                <div class="stat-value" id="cache-embeddings">-</div>
                <div class="stat-label">Cached Embeddings</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cache-videos">-</div>
                <div class="stat-label">Cached Videos</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cache-size">-</div>
                <div class="stat-label">Cache Size</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cache-last-updated">-</div>
                <div class="stat-label">Last Updated</div>
              </div>
            </div>
          </div>

          <!-- Cache Actions -->
          <div class="cache-actions">
            <button class="btn btn-primary" onclick="refreshCache()">
              üîÑ Refresh Cache Stats
            </button>
            <button class="btn btn-success" onclick="rebuildCache()">
              üî® Rebuild Cache
            </button>
            <button class="btn btn-secondary" onclick="exportCache()">
              üì§ Export Cache
            </button>
            <button class="btn btn-secondary" onclick="importCache()">
              üì• Import Cache
            </button>
            <button class="btn btn-danger" onclick="clearCache()">
              üóëÔ∏è Clear Cache
            </button>
          </div>

          <!-- Cache Operations Status -->
          <div id="cache-operations-status"></div>

          <!-- Cache Health Check -->
          <div class="config-section">
            <h3>üè• Cache Health Check</h3>
            <div id="cache-health">
              <button
                class="btn btn-secondary"
                onclick="performCacheHealthCheck()"
              >
                üîç Run Health Check
              </button>
            </div>
            <div id="cache-health-results"></div>
          </div>

          <!-- Advanced Cache Options -->
          <div class="config-section">
            <h3>üîß Advanced Options</h3>
            <div class="config-grid">
              <div>
                <label>Cache Compression:</label>
                <select id="cache-compression">
                  <option value="true" selected>Enabled</option>
                  <option value="false">Disabled</option>
                </select>
              </div>
              <div>
                <label>Auto-backup Frequency:</label>
                <select id="cache-backup-frequency">
                  <option value="never">Never</option>
                  <option value="daily" selected>Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- System Stats Tab -->
      <div id="stats-tab" class="tab-content">
        <div class="card">
          <h2 style="margin-bottom: 1rem">üìä System Statistics</h2>

          <!-- System Stats -->
          <div class="stats" id="stats">
            <div class="stat-card">
              <div class="stat-value" id="video-count">-</div>
              <div class="stat-label">Videos Indexed</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="frames-count">-</div>
              <div class="stat-label">Total Frames</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="uptime">-</div>
              <div class="stat-label">Uptime (hours)</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="system-status">-</div>
              <div class="stat-label">System Status</div>
            </div>
          </div>

          <div style="margin-top: 2rem">
            <h3>System Information</h3>
            <div
              style="
                background: var(--bg);
                padding: 1rem;
                border-radius: 8px;
                margin-top: 1rem;
              "
            >
              <p>
                <strong>Architecture:</strong> Modular FastAPI + CLIP + HNSW
              </p>
              <p>
                <strong>Search Engine:</strong> CLIP semantic understanding with
                HNSW vector index
              </p>
              <p>
                <strong>Performance:</strong> Sub-second search across thousands
                of video frames
              </p>
              <p>
                <strong>Processing:</strong> Smart video analysis with frame
                sampling optimization
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let currentTab = "search";
      let systemConfig = {
        sampling_mode: "high",
        max_frames: 300,
        use_clip: true,
        enhanced_mode: true,
        default_results: 10,
        cache_search: true,
        search_timeout: 30,
        auto_save: true,
        log_level: "INFO",
      };

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        loadSystemStats();
        loadVideoList();
        loadConfiguration();
        loadCacheStats();

        // Auto-refresh stats every 30 seconds
        setInterval(loadSystemStats, 30000);
        setInterval(loadCacheStats, 60000); // Cache stats every minute

        // Add enter key support for search
        document
          .getElementById("search-input")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              searchVideos();
            }
          });

        // Drag and drop support
        const uploadArea = document.getElementById("upload-area");
        uploadArea.addEventListener("dragover", function (e) {
          e.preventDefault();
          uploadArea.classList.add("dragover");
        });

        uploadArea.addEventListener("dragleave", function (e) {
          e.preventDefault();
          uploadArea.classList.remove("dragover");
        });

        uploadArea.addEventListener("drop", function (e) {
          e.preventDefault();
          uploadArea.classList.remove("dragover");
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            handleFileUpload(files[0]);
          }
        });
      });

      function switchTab(tab) {
        // Update tab buttons
        document
          .querySelectorAll(".tab")
          .forEach((t) => t.classList.remove("active"));
        event.target.classList.add("active");

        // Update tab content
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });
        document.getElementById(tab + "-tab").classList.add("active");

        currentTab = tab;

        // Load data for the tab
        if (tab === "videos") {
          loadVideoList();
        } else if (tab === "stats") {
          loadSystemStats();
        } else if (tab === "config") {
          loadConfiguration();
        } else if (tab === "cache") {
          loadCacheStats();
        }
      }

      // Configuration Management
      async function loadConfiguration() {
        // Try to load from backend first
        try {
          const response = await fetch("/api/config");
          if (response.ok) {
            const data = await response.json();
            if (data.success && data.config) {
              systemConfig = { ...systemConfig, ...data.config };
              console.log("Configuration loaded from backend");
            }
          }
        } catch (error) {
          console.log("Backend config not available, using localStorage");
        }

        // Fallback to localStorage
        const saved = localStorage.getItem("videoSearchConfig");
        if (saved) {
          systemConfig = { ...systemConfig, ...JSON.parse(saved) };
        }

        // Update UI
        document.getElementById("config-sampling-mode").value =
          systemConfig.sampling_mode;
        document.getElementById("config-max-frames").value =
          systemConfig.max_frames;
        document.getElementById("config-use-clip").value =
          systemConfig.use_clip.toString();
        document.getElementById("config-enhanced-mode").value =
          systemConfig.enhanced_mode.toString();
        document.getElementById("config-default-results").value =
          systemConfig.default_results;
        document.getElementById("config-cache-search").value =
          systemConfig.cache_search.toString();
        document.getElementById("config-search-timeout").value =
          systemConfig.search_timeout;
        document.getElementById("config-auto-save").value =
          systemConfig.auto_save.toString();
        document.getElementById("config-log-level").value =
          systemConfig.log_level;

        // Update search UI with saved defaults
        document.getElementById("result-count").value =
          systemConfig.default_results;
      }

      function saveConfiguration() {
        // Collect values from UI
        systemConfig = {
          sampling_mode: document.getElementById("config-sampling-mode").value,
          max_frames: parseInt(
            document.getElementById("config-max-frames").value
          ),
          use_clip: document.getElementById("config-use-clip").value === "true",
          enhanced_mode:
            document.getElementById("config-enhanced-mode").value === "true",
          default_results: parseInt(
            document.getElementById("config-default-results").value
          ),
          cache_search:
            document.getElementById("config-cache-search").value === "true",
          search_timeout: parseInt(
            document.getElementById("config-search-timeout").value
          ),
          auto_save:
            document.getElementById("config-auto-save").value === "true",
          log_level: document.getElementById("config-log-level").value,
        };

        // Save to localStorage
        localStorage.setItem("videoSearchConfig", JSON.stringify(systemConfig));

        // Update search UI
        document.getElementById("result-count").value =
          systemConfig.default_results;

        // Show success message
        showConfigStatus("‚úÖ Configuration saved successfully!", "success");

        // Send to backend (if endpoint exists)
        updateBackendConfig();
      }

      async function updateBackendConfig() {
        try {
          const response = await fetch("/api/config", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(systemConfig),
          });

          if (response.ok) {
            console.log("Backend configuration updated");
          }
        } catch (error) {
          console.log("Backend config update not available");
        }
      }

      function showConfigStatus(message, type) {
        const statusDiv = document.getElementById("config-status");
        statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        setTimeout(() => (statusDiv.innerHTML = ""), 5000);
      }

      // Cache Management
      async function loadCacheStats() {
        try {
          const response = await fetch("/api/cache/stats");
          if (response.ok) {
            const stats = await response.json();
            document.getElementById("cache-embeddings").textContent =
              stats.embeddings || "-";
            document.getElementById("cache-videos").textContent =
              stats.videos || "-";
            document.getElementById("cache-size").textContent = formatFileSize(
              stats.size || 0
            );
            document.getElementById("cache-last-updated").textContent =
              stats.last_updated
                ? new Date(stats.last_updated * 1000).toLocaleDateString()
                : "-";
          } else {
            // Fallback to system stats
            const statsResponse = await fetch("/api/stats");
            const stats = await statsResponse.json();
            document.getElementById("cache-embeddings").textContent =
              stats.total_embeddings || "-";
            document.getElementById("cache-videos").textContent =
              stats.total_videos || "-";
            document.getElementById("cache-size").textContent = "Unknown";
            document.getElementById("cache-last-updated").textContent =
              "Unknown";
          }
        } catch (error) {
          console.error("Failed to load cache stats:", error);
        }
      }

      async function refreshCache() {
        showCacheStatus("üîÑ Refreshing cache statistics...", "info");
        await loadCacheStats();
        showCacheStatus("‚úÖ Cache statistics refreshed!", "success");
      }

      async function rebuildCache() {
        if (
          !confirm(
            "This will rebuild the entire cache from scratch. This may take several minutes. Continue?"
          )
        ) {
          return;
        }

        showCacheStatus(
          "üî® Rebuilding cache... This may take several minutes.",
          "info"
        );

        try {
          const response = await fetch("/api/cache/rebuild", {
            method: "POST",
          });
          if (response.ok) {
            showCacheStatus("‚úÖ Cache rebuilt successfully!", "success");
            await loadCacheStats();
            await loadSystemStats();
          } else {
            throw new Error("Cache rebuild failed");
          }
        } catch (error) {
          showCacheStatus("‚ùå Cache rebuild failed: " + error.message, "error");
        }
      }

      async function clearCache() {
        if (
          !confirm(
            "This will delete all cached data. Videos will need to be reprocessed. Continue?"
          )
        ) {
          return;
        }

        showCacheStatus("üóëÔ∏è Clearing cache...", "info");

        try {
          const response = await fetch("/api/cache/clear", { method: "POST" });
          if (response.ok) {
            showCacheStatus("‚úÖ Cache cleared successfully!", "success");
            await loadCacheStats();
            await loadSystemStats();
          } else {
            throw new Error("Cache clear failed");
          }
        } catch (error) {
          showCacheStatus("‚ùå Cache clear failed: " + error.message, "error");
        }
      }

      async function exportCache() {
        showCacheStatus("üì§ Exporting cache...", "info");

        try {
          const response = await fetch("/api/cache/export");
          if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `video_cache_${
              new Date().toISOString().split("T")[0]
            }.pkl`;
            a.click();
            window.URL.revokeObjectURL(url);
            showCacheStatus("‚úÖ Cache exported successfully!", "success");
          } else {
            throw new Error("Cache export failed");
          }
        } catch (error) {
          showCacheStatus("‚ùå Cache export failed: " + error.message, "error");
        }
      }

      function importCache() {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = ".pkl";
        input.onchange = async function (e) {
          const file = e.target.files[0];
          if (!file) return;

          showCacheStatus("üì• Importing cache...", "info");

          const formData = new FormData();
          formData.append("cache_file", file);

          try {
            const response = await fetch("/api/cache/import", {
              method: "POST",
              body: formData,
            });

            if (response.ok) {
              showCacheStatus("‚úÖ Cache imported successfully!", "success");
              await loadCacheStats();
              await loadSystemStats();
            } else {
              throw new Error("Cache import failed");
            }
          } catch (error) {
            showCacheStatus(
              "‚ùå Cache import failed: " + error.message,
              "error"
            );
          }
        };
        input.click();
      }

      async function performCacheHealthCheck() {
        showCacheStatus("üîç Performing cache health check...", "info");

        try {
          const response = await fetch("/api/cache/health");
          if (response.ok) {
            const health = await response.json();

            let healthHtml = '<div style="margin-top: 1rem;">';
            healthHtml += "<h4>Health Check Results:</h4>";
            healthHtml += `<p>Overall Status: ${
              health.status === "healthy" ? "‚úÖ Healthy" : "‚ö†Ô∏è Issues Found"
            }</p>`;

            if (health.issues && health.issues.length > 0) {
              healthHtml += "<h5>Issues Found:</h5><ul>";
              health.issues.forEach((issue) => {
                healthHtml += `<li>${issue}</li>`;
              });
              healthHtml += "</ul>";
            }

            if (health.recommendations && health.recommendations.length > 0) {
              healthHtml += "<h5>Recommendations:</h5><ul>";
              health.recommendations.forEach((rec) => {
                healthHtml += `<li>${rec}</li>`;
              });
              healthHtml += "</ul>";
            }

            healthHtml += "</div>";
            document.getElementById("cache-health-results").innerHTML =
              healthHtml;

            showCacheStatus("‚úÖ Health check completed!", "success");
          } else {
            throw new Error("Health check failed");
          }
        } catch (error) {
          showCacheStatus("‚ùå Health check failed: " + error.message, "error");
          document.getElementById("cache-health-results").innerHTML =
            '<p style="color: var(--error);">Health check unavailable</p>';
        }
      }

      function showCacheStatus(message, type) {
        const statusDiv = document.getElementById("cache-operations-status");
        statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        if (type === "success") {
          setTimeout(() => (statusDiv.innerHTML = ""), 5000);
        }
      }

      // Existing functions (search, upload, etc.) with configuration integration
      async function loadSystemStats() {
        try {
          const response = await fetch("/api/stats");
          const stats = await response.json();

          document.getElementById("video-count").textContent =
            stats.total_videos || stats.video_count;
          document.getElementById("frames-count").textContent =
            stats.total_frames_indexed;
          document.getElementById("uptime").textContent = (
            stats.uptime_seconds / 3600
          ).toFixed(1);
          document.getElementById("system-status").textContent =
            stats.system_ready ? "‚úÖ Ready" : "‚ö†Ô∏è Starting";
        } catch (error) {
          console.error("Failed to load stats:", error);
          document.getElementById("system-status").textContent = "‚ùå Error";
        }
      }

      async function searchVideos() {
        const query = document.getElementById("search-input").value.trim();
        const k = parseInt(document.getElementById("result-count").value);

        if (!query) {
          showStatus("Please enter a search query", "error");
          return;
        }

        // Update UI
        document.getElementById("search-icon").innerHTML =
          '<div class="loading"></div>';
        const resultsDiv = document.getElementById("search-results");
        resultsDiv.innerHTML =
          '<div class="status info">üîç Searching with CLIP semantic understanding...</div>';

        try {
          const response = await fetch("/api/search", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              query: query,
              k: k,
              use_cache: systemConfig.cache_search,
            }),
          });

          if (!response.ok) {
            throw new Error(`Search failed: ${response.status}`);
          }

          const data = await response.json();
          displaySearchResults(data);
        } catch (error) {
          console.error("Search failed:", error);
          resultsDiv.innerHTML = `<div class="status error">‚ùå Search failed: ${error.message}</div>`;
        } finally {
          document.getElementById("search-icon").textContent = "üîç";
        }
      }

      function displaySearchResults(data) {
        const resultsDiv = document.getElementById("search-results");

        if (!data.results || data.results.length === 0) {
          resultsDiv.innerHTML =
            '<div class="status info">üì≠ No results found. Try different keywords!</div>';
          return;
        }

        let searchTime;
        if (data.search_time_ms) {
          if (data.search_time_ms > 10000) {
            searchTime = (data.search_time_ms / 1000000).toFixed(3);
          } else if (data.search_time_ms > 10) {
            searchTime = (data.search_time_ms / 1000).toFixed(3);
          } else {
            searchTime = data.search_time_ms.toFixed(3);
          }
        } else {
          searchTime = "Unknown";
        }

        let html = `
                <div class="status success">
                    ‚úÖ Found ${data.results.length} results in ${searchTime}s
                </div>
                <div class="results-grid">
            `;

        data.results.forEach((result, index) => {
          const videoName =
            result.video_file || result.video_name || "Unknown Video";
          const confidence = (
            (result.confidence || result.score || 0) * 100
          ).toFixed(1);
          const timestamp = formatTimestamp(result.timestamp || 0);

          html += `
                    <div class="result-card" onclick="showVideoFrame('${videoName.replace(
                      /'/g,
                      "\\'"
                    )}', ${
            result.timestamp || 0
          }, '${confidence}%', ${index})" style="cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div class="result-info">
                            <div class="result-title">üìπ ${videoName}</div>
                            <div class="result-meta">
                                üïí ${timestamp} ‚Ä¢ üìä ${confidence}% match
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${confidence}%"></div>
                            </div>
                            <div class="confidence-text">${confidence}% confidence</div>
                            <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted); font-weight: 500;">
                                üëÅÔ∏è Click to view video at timestamp
                            </div>
                        </div>
                    </div>
                `;
        });

        html += "</div>";
        resultsDiv.innerHTML = html;
      }

      async function uploadVideo() {
        const fileInput = document.getElementById("file-input");
        const file = fileInput.files[0];

        if (!file) return;

        handleFileUpload(file);
      }

      function switchUploadMethod(method) {
        const fileUploadBtn = document.getElementById("file-upload-btn");
        const youtubeDownloadBtn = document.getElementById(
          "youtube-download-btn"
        );
        const fileUploadSection = document.getElementById(
          "file-upload-section"
        );
        const youtubeDownloadSection = document.getElementById(
          "youtube-download-section"
        );

        if (method === "file") {
          fileUploadBtn.style.background = "var(--accent-color)";
          fileUploadBtn.style.color = "white";
          fileUploadBtn.classList.remove("btn-outline");

          youtubeDownloadBtn.style.background = "transparent";
          youtubeDownloadBtn.style.color = "var(--accent-color)";
          youtubeDownloadBtn.classList.add("btn-outline");

          fileUploadSection.classList.remove("hidden");
          youtubeDownloadSection.classList.add("hidden");
        } else {
          youtubeDownloadBtn.style.background = "var(--accent-color)";
          youtubeDownloadBtn.style.color = "white";
          youtubeDownloadBtn.classList.remove("btn-outline");

          fileUploadBtn.style.background = "transparent";
          fileUploadBtn.style.color = "var(--accent-color)";
          fileUploadBtn.classList.add("btn-outline");

          fileUploadSection.classList.add("hidden");
          youtubeDownloadSection.classList.remove("hidden");
        }
      }

      async function downloadYouTubeVideo() {
        const urlInput = document.getElementById("youtube-url");
        const qualitySelect = document.getElementById("quality-select");
        const url = urlInput.value.trim();
        const quality = qualitySelect.value;

        if (!url) {
          showStatus("Please enter a YouTube URL", "error");
          return;
        }

        // Basic YouTube URL validation
        if (!url.includes("youtube.com/watch") && !url.includes("youtu.be/")) {
          showStatus("Please enter a valid YouTube URL", "error");
          return;
        }

        // Show progress
        document.getElementById("upload-progress").classList.remove("hidden");
        document.getElementById("upload-status-text").textContent =
          "Downloading from YouTube...";
        document.getElementById("upload-status").innerHTML = "";

        try {
          const response = await fetch("/api/videos/download-youtube", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              url: url,
              quality: quality,
              config: {
                sampling_mode: systemConfig.sampling_mode,
                max_frames: systemConfig.max_frames,
                use_clip: systemConfig.use_clip,
                enhanced_mode: systemConfig.enhanced_mode,
              },
            }),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(
              errorData.detail || `Download failed: ${response.status}`
            );
          }

          const result = await response.json();

          document.getElementById("upload-progress").classList.add("hidden");
          showStatus(
            `‚úÖ YouTube video downloaded and processed successfully! ${result.frames_indexed} frames indexed.`,
            "success"
          );

          // Clear the URL input
          urlInput.value = "";

          // Refresh stats and video list
          loadSystemStats();
          loadCacheStats();
          if (currentTab === "videos") {
            loadVideoList();
          }
        } catch (error) {
          document.getElementById("upload-progress").classList.add("hidden");
          showStatus(`‚ùå YouTube download failed: ${error.message}`, "error");
        }
      }

      async function handleFileUpload(file) {
        const allowedTypes = [
          "video/mp4",
          "video/avi",
          "video/mov",
          "video/quicktime",
          "video/x-msvideo",
        ];

        if (
          !allowedTypes.includes(file.type) &&
          !file.name.match(/\.(mp4|avi|mov|mkv)$/i)
        ) {
          showStatus(
            "Please select a valid video file (MP4, AVI, MOV, MKV)",
            "error"
          );
          return;
        }

        if (file.size > 1024 * 1024 * 1024) {
          // 1GB
          showStatus("File too large. Maximum size is 1GB.", "error");
          return;
        }

        // Show progress
        document.getElementById("upload-progress").classList.remove("hidden");
        document.getElementById("upload-status").innerHTML = "";

        const formData = new FormData();
        formData.append("file", file);

        // Add processing configuration
        formData.append(
          "config",
          JSON.stringify({
            sampling_mode: systemConfig.sampling_mode,
            max_frames: systemConfig.max_frames,
            use_clip: systemConfig.use_clip,
            enhanced_mode: systemConfig.enhanced_mode,
          })
        );

        try {
          const response = await fetch("/api/videos/upload", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            throw new Error(`Upload failed: ${response.status}`);
          }

          const result = await response.json();

          document.getElementById("upload-progress").classList.add("hidden");
          showStatus(
            `‚úÖ Video uploaded and processed successfully! ${result.frames_indexed} frames indexed.`,
            "success"
          );

          // Refresh stats and video list
          loadSystemStats();
          loadCacheStats();
          if (currentTab === "videos") {
            loadVideoList();
          }
        } catch (error) {
          document.getElementById("upload-progress").classList.add("hidden");
          showStatus(`‚ùå Upload failed: ${error.message}`, "error");
        }
      }

      async function loadVideoList() {
        try {
          const response = await fetch("/api/videos");
          const data = await response.json();

          const videoList = document.getElementById("video-list");

          if (!data.videos || data.videos.length === 0) {
            videoList.innerHTML =
              '<div class="status info">üìÅ No videos found. Upload some videos to get started!</div>';
            return;
          }

          let html = "";
          data.videos.forEach((video) => {
            const size = formatFileSize(video.size);
            const date = new Date(
              video.processed_at * 1000
            ).toLocaleDateString();

            html += `
                        <div class="video-item">
                            <div class="video-info">
                                <h4>üìπ ${video.filename}</h4>
                                <div class="video-meta">
                                    üìä ${size} ‚Ä¢ üìÖ Processed: ${date} ‚Ä¢ üÜî ${video.video_id}
                                </div>
                            </div>
                            <button class="btn btn-small btn-secondary" onclick="deleteVideo('${video.video_id}')">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    `;
          });

          videoList.innerHTML = html;
        } catch (error) {
          console.error("Failed to load video list:", error);
          document.getElementById("video-list").innerHTML =
            '<div class="status error">‚ùå Failed to load videos</div>';
        }
      }

      async function deleteVideo(videoId) {
        if (!confirm("Are you sure you want to delete this video?")) {
          return;
        }

        try {
          const response = await fetch(`/api/videos/${videoId}`, {
            method: "DELETE",
          });

          if (!response.ok) {
            throw new Error(`Delete failed: ${response.status}`);
          }

          showStatus("‚úÖ Video deleted successfully", "success");
          loadVideoList();
          loadSystemStats();
          loadCacheStats();
        } catch (error) {
          showStatus(`‚ùå Delete failed: ${error.message}`, "error");
        }
      }

      function showStatus(message, type) {
        const statusDiv = document.getElementById("upload-status");
        statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;

        setTimeout(() => {
          statusDiv.innerHTML = "";
        }, 5000);
      }

      function formatTimestamp(seconds) {
        if (!seconds || isNaN(seconds)) {
          return "0:00";
        }
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, "0")}`;
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      async function showVideoFrame(
        videoName,
        timestamp,
        confidence,
        resultIndex
      ) {
        const modal = document.getElementById("frame-modal");
        const frameContainer = document.getElementById("frame-container");
        const modalVideoName = document.getElementById("modal-video-name");
        const modalTimestamp = document.getElementById("modal-timestamp");
        const modalConfidence = document.getElementById("modal-confidence");

        // Set modal info
        modalVideoName.textContent = videoName;
        modalTimestamp.textContent = formatTimestamp(timestamp);
        modalConfidence.textContent = confidence;

        // Show modal
        modal.classList.remove("hidden");
        modal.style.display = "flex";

        frameContainer.innerHTML = "<p>Loading video...</p>";

        try {
          const response = await fetch("/api/videos");
          const data = await response.json();

          const matchingVideo = data.videos.find(
            (video) =>
              video.filename === videoName ||
              video.filename.includes(
                videoName.replace(/\.(mp4|avi|mov|mkv)$/i, "")
              )
          );

          if (!matchingVideo) {
            frameContainer.innerHTML =
              '<p style="color: var(--error);">Video file not found</p>';
            return;
          }

          const videoPath = `/videos/${encodeURIComponent(
            matchingVideo.filename
          )}`;

          frameContainer.innerHTML = `
                    <video controls style="max-width: 100%; height: auto; border-radius: 8px;" preload="metadata">
                        <source src="${videoPath}" type="video/mp4">
                        <source src="${videoPath}" type="video/mov">
                        <source src="${videoPath}" type="video/avi">
                        <p style="color: var(--error);">Your browser doesn't support video playback.</p>
                    </video>
                    <p style="margin-top: 1rem; color: var(--text-muted); font-size: 0.875rem;">
                        Video will start at the matched timestamp (${formatTimestamp(
                          timestamp
                        )})
                    </p>
                `;

          const video = frameContainer.querySelector("video");
          video.addEventListener("loadedmetadata", function () {
            if (timestamp && timestamp > 0) {
              video.currentTime = timestamp;
            }
          });

          video.addEventListener("error", function () {
            frameContainer.innerHTML =
              '<p style="color: var(--error);">Error loading video. Please check if the file exists.</p>';
          });
        } catch (error) {
          console.error("Error loading video:", error);
          frameContainer.innerHTML =
            '<p style="color: var(--error);">Error loading video information</p>';
        }
      }

      function closeFrameModal() {
        const modal = document.getElementById("frame-modal");
        const frameContainer = document.getElementById("frame-container");

        modal.style.display = "none";
        modal.classList.add("hidden");

        if (frameContainer) {
          const videos = frameContainer.querySelectorAll("video");
          videos.forEach((video) => {
            video.pause();
            video.src = "";
            video.load();
          });

          frameContainer.innerHTML = "<p>Loading frame...</p>";
        }

        document.querySelectorAll("video").forEach((video) => {
          video.pause();
          video.src = "";
        });

        return false;
      }

      // Close modal when clicking outside
      document.addEventListener("click", function (event) {
        const modal = document.getElementById("frame-modal");
        if (event.target === modal) {
          closeFrameModal();
        }
      });

      // Close modal with Escape key
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closeFrameModal();
        }
      });
    </script>
  </body>
</html>
